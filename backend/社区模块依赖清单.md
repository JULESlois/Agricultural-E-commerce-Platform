# 社区模块依赖清单

## 概述

社区模块是农业电商平台的用户社交和内容互动模块，运行在端口 **3003**。

## Node.js 依赖包

所有依赖需要安装在 `backend/community` 目录下。

### 生产依赖 (Production Dependencies)

| 包名 | 版本 | 用途 | 说明 |
|------|------|------|------|
| express | ^4.18.2 | Web框架 | 提供HTTP服务器、路由、中间件等核心功能 |
| pg | ^8.11.3 | 数据库驱动 | 连接和操作PostgreSQL数据库，支持Promise API |
| jsonwebtoken | ^9.0.2 | JWT认证 | 验证用户身份令牌 |
| dotenv | ^16.3.1 | 环境变量 | 从.env文件加载配置信息 |
| cors | ^2.8.5 | 跨域支持 | 处理跨域资源共享请求 |

### 开发依赖 (Development Dependencies)

| 包名 | 版本 | 用途 | 说明 |
|------|------|------|------|
| nodemon | ^3.0.2 | 热重载 | 开发时自动重启服务 |

## 安装方式

### 方式一：在社区模块目录安装
```bash
cd backend/community
npm install
```

### 方式二：从backend根目录统一安装
```bash
cd backend
npm run install:all
```

这会依次安装所有模块（auth、market、community）的依赖。

## 依赖详细说明

### 1. express (^4.18.2)
**核心Web框架**
- 提供路由管理
- 中间件支持
- HTTP请求/响应处理
- 静态文件服务

**使用场景**：
- 所有API接口的基础
- 请求日志记录
- 错误处理

### 2. pg (^8.11.3)
**PostgreSQL数据库驱动**
- 支持Promise/async-await
- 连接池管理
- 预编译语句
- 事务支持

**使用场景**：
- 所有数据库CRUD操作
- 用户关注、内容发布、评论等功能
- 数据统计查询

### 3. jsonwebtoken (^9.0.2)
**JWT令牌处理**
- 令牌验证
- 用户身份识别
- 权限控制

**使用场景**：
- 认证中间件
- 保护需要登录的接口
- 验证管理员权限

**重要**：JWT_SECRET必须与认证服务保持一致！

### 4. dotenv (^16.3.1)
**环境变量管理**
- 加载.env文件
- 配置管理
- 敏感信息保护

**使用场景**：
- 数据库连接配置
- JWT密钥配置
- 端口配置

### 5. cors (^2.8.5)
**跨域资源共享**
- 处理OPTIONS预检请求
- 设置CORS响应头
- 允许跨域访问

**使用场景**：
- 允许前端应用访问API
- 配置允许的域名和方法

### 6. nodemon (^3.0.2)
**开发工具**
- 监听文件变化
- 自动重启服务
- 提高开发效率

**使用场景**：
- 仅用于开发环境
- 通过 `npm run dev` 启动

## 依赖关系图

```
社区模块 (community-service)
├── express (Web框架)
│   ├── 路由管理
│   ├── 中间件
│   └── 错误处理
├── mysql2 (数据库)
│   ├── 连接池
│   ├── 查询操作
│   └── 事务管理
├── jsonwebtoken (认证)
│   ├── Token验证
│   └── 权限控制
├── dotenv (配置)
│   └── 环境变量
├── cors (跨域)
│   └── CORS处理
└── nodemon (开发)
    └── 热重载
```

## 与其他模块的关系

### 认证服务 (auth-service, 端口3002)
- **依赖关系**：社区模块依赖认证服务生成的JWT token
- **共享配置**：JWT_SECRET必须一致
- **数据共享**：共享users表

### 市场服务 (market-service, 端口3001)
- **独立运行**：各自独立的依赖和配置
- **数据隔离**：使用不同的数据表

## 版本兼容性

- **Node.js**: 建议 v14.0.0 或更高版本
- **MySQL**: 建议 v5.7 或更高版本
- **npm**: 建议 v6.0.0 或更高版本

## 生产环境建议

1. **不安装开发依赖**
   ```bash
   npm install --production
   ```

2. **使用进程管理器**
   - PM2（推荐）
   - Forever
   - systemd

3. **配置反向代理**
   - Nginx
   - Apache

4. **启用日志管理**
   - Winston
   - Morgan
   - PM2 logs

## 安全注意事项

1. **JWT_SECRET**
   - 使用强密码
   - 定期更换
   - 不要提交到版本控制

2. **数据库密码**
   - 使用强密码
   - 限制访问权限
   - 不要使用root账户

3. **CORS配置**
   - 生产环境指定具体域名
   - 不要使用通配符 `*`

4. **依赖更新**
   - 定期检查安全漏洞
   - 及时更新补丁版本
   - 使用 `npm audit` 检查

## 故障排查

### 依赖安装失败
```bash
# 清除缓存
npm cache clean --force

# 删除node_modules重新安装
rm -rf node_modules
npm install
```

### 模块找不到
```bash
# 确认在正确的目录
cd backend/community

# 检查package.json
cat package.json

# 重新安装
npm install
```

### 版本冲突
```bash
# 查看依赖树
npm list

# 更新到兼容版本
npm update
```

## 总结

社区模块共使用 **6个npm包**：
- **5个生产依赖**：express, mysql2, jsonwebtoken, dotenv, cors
- **1个开发依赖**：nodemon

所有依赖都是成熟稳定的包，在Node.js生态中广泛使用，安全可靠。

安装命令：
```bash
cd backend/community
npm install
```

启动命令：
```bash
npm run dev  # 开发环境
npm start    # 生产环境
```
