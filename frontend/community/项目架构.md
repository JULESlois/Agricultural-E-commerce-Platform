# 智农链社区前端 - 项目架构

## 整体架构

```
┌─────────────────────────────────────────────────────────┐
│                    浏览器 (Browser)                      │
│                  http://localhost:5174                   │
└─────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────┐
│                   React Application                      │
│  ┌───────────────────────────────────────────────────┐  │
│  │              App.tsx (路由配置)                    │  │
│  │  ┌─────────────────────────────────────────────┐  │  │
│  │  │  Header (顶部导航)                          │  │  │
│  │  └─────────────────────────────────────────────┘  │  │
│  │  ┌─────────────────────────────────────────────┐  │  │
│  │  │  Routes (页面路由)                          │  │  │
│  │  │  ├─ Home (首页)                             │  │  │
│  │  │  ├─ ContentDetail (详情)                    │  │  │
│  │  │  └─ Publish (发布)                          │  │  │
│  │  └─────────────────────────────────────────────┘  │  │
│  └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
                            │
                            ▼ (Axios + Proxy)
┌─────────────────────────────────────────────────────────┐
│              Backend API (后端服务)                      │
│                  http://localhost:3003                   │
│  ┌───────────────────────────────────────────────────┐  │
│  │  /api/community/content      (内容管理)          │  │
│  │  /api/community/follows      (关注功能)          │  │
│  │  /api/community/questions    (问答系统)          │  │
│  │  /api/community/reports      (举报功能)          │  │
│  └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────┐
│                  PostgreSQL Database                     │
│                    (云数据库)                            │
└─────────────────────────────────────────────────────────┘
```

## 目录结构

```
frontend/community/
│
├── public/                          # 静态资源
│   └── vite.svg                     # 项目图标
│
├── src/                             # 源代码
│   │
│   ├── api/                         # API 接口层
│   │   ├── content.ts               # 内容相关接口
│   │   ├── follow.ts                # 关注相关接口
│   │   ├── qa.ts                    # 问答相关接口
│   │   └── report.ts                # 举报相关接口
│   │
│   ├── components/                  # 组件层
│   │   ├── Layout/                  # 布局组件
│   │   │   ├── Header.tsx           # 顶部导航
│   │   │   └── Sidebar.tsx          # 侧边栏
│   │   ├── ContentCard.tsx          # 内容卡片
│   │   └── CommentItem.tsx          # 评论项
│   │
│   ├── pages/                       # 页面层
│   │   ├── Home.tsx                 # 首页
│   │   ├── ContentDetail.tsx        # 内容详情
│   │   └── Publish.tsx              # 发布页面
│   │
│   ├── store/                       # 状态管理层
│   │   └── userStore.ts             # 用户状态
│   │
│   ├── styles/                      # 样式层
│   │   ├── colors.ts                # 配色方案
│   │   └── global.css               # 全局样式
│   │
│   ├── types/                       # 类型定义层
│   │   └── index.ts                 # 所有类型
│   │
│   ├── utils/                       # 工具层
│   │   └── request.ts               # HTTP 请求封装
│   │
│   ├── App.tsx                      # 应用根组件
│   └── main.tsx                     # 应用入口
│
├── .gitignore                       # Git 忽略规则
├── index.html                       # HTML 模板
├── package.json                     # 项目配置
├── tsconfig.json                    # TypeScript 配置
├── tsconfig.node.json               # TypeScript Node 配置
├── vite.config.ts                   # Vite 配置
├── start-dev.bat                    # 启动脚本
│
└── 文档/
    ├── README.md                    # 项目文档
    ├── 项目说明.md                  # 详细说明
    ├── 快速开始.md                  # 快速指南
    ├── 项目架构.md                  # 本文档
    └── ✅项目完成清单.md            # 完成清单
```

## 技术架构

### 前端技术栈

```
┌─────────────────────────────────────────┐
│           React 19.2.0                  │  UI 框架
├─────────────────────────────────────────┤
│        TypeScript 5.8.2                 │  类型系统
├─────────────────────────────────────────┤
│           Vite 6.2.0                    │  构建工具
├─────────────────────────────────────────┤
│      React Router 6.22.0                │  路由管理
├─────────────────────────────────────────┤
│          Axios 1.6.7                    │  HTTP 客户端
├─────────────────────────────────────────┤
│         Zustand 4.5.0                   │  状态管理
└─────────────────────────────────────────┘
```

### 数据流架构

```
┌──────────┐      ┌──────────┐      ┌──────────┐      ┌──────────┐
│   User   │ ───> │   Page   │ ───> │   API    │ ───> │  Backend │
│  Action  │      │Component │      │  Layer   │      │   API    │
└──────────┘      └──────────┘      └──────────┘      └──────────┘
                        │                                     │
                        │                                     │
                        ▼                                     ▼
                  ┌──────────┐                         ┌──────────┐
                  │  Store   │                         │ Database │
                  │ (Zustand)│                         │(Postgres)│
                  └──────────┘                         └──────────┘
                        │                                     │
                        │                                     │
                        ▼                                     ▼
                  ┌──────────┐      ┌──────────┐      ┌──────────┐
                  │   UI     │ <─── │   API    │ <─── │  Backend │
                  │  Update  │      │ Response │      │ Response │
                  └──────────┘      └──────────┘      └──────────┘
```

## 组件架构

### 页面组件层次

```
App
├── Header (全局)
│   ├── Logo
│   ├── Navigation
│   └── UserInfo
│
└── Routes
    │
    ├── Home (首页)
    │   ├── Sidebar
    │   │   └── CategoryTree
    │   └── ContentList
    │       └── ContentCard (多个)
    │           ├── AuthorInfo
    │           ├── ContentPreview
    │           ├── Tags
    │           └── Stats
    │
    ├── ContentDetail (详情页)
    │   ├── ContentHeader
    │   ├── ContentBody
    │   ├── ActionBar
    │   └── CommentSection
    │       └── CommentItem (多个)
    │           └── CommentItem (嵌套)
    │
    └── Publish (发布页)
        ├── TypeSelector
        ├── CategorySelector
        ├── TitleInput
        ├── ContentEditor
        ├── TagSelector
        └── SubmitButton
```

## API 架构

### 接口分层

```
┌─────────────────────────────────────────────────────────┐
│                    API Layer (api/)                      │
├─────────────────────────────────────────────────────────┤
│  content.ts  │  follow.ts  │  qa.ts  │  report.ts      │
│  ├─ getList  │  ├─ follow  │  ├─adopt│  └─ submit      │
│  ├─ getDetail│  ├─ unfollow│  └─cancel                 │
│  ├─ create   │  ├─ getFollowing                         │
│  ├─ like     │  ├─ getFollowers                         │
│  ├─ collect  │  ├─ block                                │
│  ├─ comment  │  └─ unblock                              │
│  └─ getTags  │                                           │
└─────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────┐
│                 Utils Layer (utils/)                     │
├─────────────────────────────────────────────────────────┤
│                    request.ts                            │
│  ├─ Request Interceptor (添加 Token)                    │
│  ├─ Response Interceptor (错误处理)                     │
│  └─ Axios Instance                                       │
└─────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────┐
│                  Backend API Endpoints                   │
├─────────────────────────────────────────────────────────┤
│  /api/community/content                                  │
│  /api/community/follows                                  │
│  /api/community/questions                                │
│  /api/community/reports                                  │
└─────────────────────────────────────────────────────────┘
```

## 状态管理架构

### Zustand Store

```
┌─────────────────────────────────────────┐
│           userStore (Zustand)           │
├─────────────────────────────────────────┤
│  State:                                 │
│  ├─ currentUser: User | null            │
│  │                                      │
│  Actions:                               │
│  ├─ setCurrentUser(user)                │
│  └─ isLoggedIn()                        │
└─────────────────────────────────────────┘
```

### 组件状态

```
页面级状态 (useState)
├─ Home
│  ├─ contents: Content[]
│  ├─ loading: boolean
│  └─ sortType: string
│
├─ ContentDetail
│  ├─ content: Content
│  ├─ comments: Comment[]
│  └─ commentText: string
│
└─ Publish
   ├─ formData: FormData
   ├─ selectedTags: Tag[]
   └─ loading: boolean
```

## 路由架构

```
┌─────────────────────────────────────────┐
│         React Router v6                 │
├─────────────────────────────────────────┤
│  /                                      │
│  └─> Home (首页)                        │
│      ├─ 内容列表                        │
│      ├─ 分类筛选                        │
│      └─ 排序切换                        │
│                                         │
│  /content/:id                           │
│  └─> ContentDetail (详情页)            │
│      ├─ 内容展示                        │
│      ├─ 评论互动                        │
│      └─ 点赞收藏                        │
│                                         │
│  /publish                               │
│  └─> Publish (发布页)                  │
│      ├─ 类型选择                        │
│      ├─ 内容编辑                        │
│      └─ 标签添加                        │
└─────────────────────────────────────────┘
```

## 样式架构

### 配色系统

```
┌─────────────────────────────────────────┐
│         colors.ts (莫兰迪色系)          │
├─────────────────────────────────────────┤
│  primary (主色 - 深绿)                  │
│  ├─ main: #5F7367                       │
│  ├─ light: #7A8E82                      │
│  ├─ dark: #4A5B52                       │
│  └─ bg: #F5F7F6                         │
│                                         │
│  secondary (辅助色)                     │
│  ├─ brick: #A67C7C (砖红)              │
│  ├─ blue: #7B8FA3 (沙蓝)               │
│  └─ gold: #B8A57A (暗金)               │
│                                         │
│  neutral (中性色)                       │
│  ├─ white: #FFFFFF                      │
│  ├─ bg: #F8F9F8                         │
│  ├─ border: #E5E8E6                     │
│  ├─ text: #3D4A42                       │
│  ├─ textLight: #6B7870                  │
│  └─ textLighter: #9BA39E                │
│                                         │
│  status (功能色)                        │
│  ├─ success: #7A9B7E                    │
│  ├─ warning: #B8A57A                    │
│  ├─ error: #A67C7C                      │
│  └─ info: #7B8FA3                       │
└─────────────────────────────────────────┘
```

### 样式方案

```
┌─────────────────────────────────────────┐
│           Inline Styles                 │
│  (组件内部使用 style 对象)              │
├─────────────────────────────────────────┤
│  优点:                                  │
│  ├─ 类型安全                            │
│  ├─ 动态样式                            │
│  ├─ 组件封装                            │
│  └─ 易于主题定制                        │
└─────────────────────────────────────────┘
```

## 类型系统架构

```
┌─────────────────────────────────────────┐
│         types/index.ts                  │
├─────────────────────────────────────────┤
│  User                                   │
│  ├─ user_id: number                     │
│  ├─ user_name: string                   │
│  ├─ avatar?: string                     │
│  └─ is_mutual?: boolean                 │
│                                         │
│  Content                                │
│  ├─ content_id: number                  │
│  ├─ content_title: string               │
│  ├─ content_type: number                │
│  ├─ author: User                        │
│  ├─ tags?: Tag[]                        │
│  └─ ...                                 │
│                                         │
│  Comment                                │
│  ├─ comment_id: number                  │
│  ├─ user_info: User                     │
│  ├─ comment_text: string                │
│  ├─ replies?: Comment[]                 │
│  └─ ...                                 │
│                                         │
│  Category, Tag, ApiResponse, Report     │
└─────────────────────────────────────────┘
```

## 构建流程

```
┌─────────────────────────────────────────┐
│         Development (开发)              │
├─────────────────────────────────────────┤
│  npm run dev                            │
│  └─> Vite Dev Server                    │
│      ├─ HMR (热更新)                    │
│      ├─ TypeScript 编译                 │
│      ├─ React Fast Refresh              │
│      └─ Proxy to Backend                │
└─────────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────┐
│         Production (生产)               │
├─────────────────────────────────────────┤
│  npm run build                          │
│  └─> Vite Build                         │
│      ├─ TypeScript 编译                 │
│      ├─ 代码压缩                        │
│      ├─ Tree Shaking                    │
│      ├─ 资源优化                        │
│      └─ 生成 dist/                      │
└─────────────────────────────────────────┘
```

## 部署架构

```
┌─────────────────────────────────────────┐
│         Static Server                   │
│  (Nginx / Apache / CDN)                 │
├─────────────────────────────────────────┤
│  dist/                                  │
│  ├─ index.html                          │
│  ├─ assets/                             │
│  │  ├─ index-[hash].js                  │
│  │  └─ index-[hash].css                 │
│  └─ vite.svg                            │
└─────────────────────────────────────────┘
                  │
                  ▼ (API Requests)
┌─────────────────────────────────────────┐
│         Backend Server                  │
│      http://api.example.com             │
└─────────────────────────────────────────┘
```

## 安全架构

```
┌─────────────────────────────────────────┐
│         Security Measures               │
├─────────────────────────────────────────┤
│  1. JWT Token 认证                      │
│     └─ localStorage 存储                │
│                                         │
│  2. HTTPS 加密传输                      │
│     └─ 生产环境必须                     │
│                                         │
│  3. XSS 防护                            │
│     └─ React 自动转义                   │
│                                         │
│  4. CSRF 防护                           │
│     └─ Token 验证                       │
│                                         │
│  5. 输入验证                            │
│     └─ 前后端双重验证                   │
└─────────────────────────────────────────┘
```

## 性能优化架构

```
┌─────────────────────────────────────────┐
│      Performance Optimization           │
├─────────────────────────────────────────┤
│  已实现:                                │
│  ├─ Code Splitting (Vite 自动)          │
│  ├─ Tree Shaking                        │
│  ├─ 资源压缩                            │
│  └─ 浏览器缓存                          │
│                                         │
│  待优化:                                │
│  ├─ 虚拟滚动 (长列表)                   │
│  ├─ 图片懒加载                          │
│  ├─ 路由懒加载                          │
│  └─ 组件懒加载                          │
└─────────────────────────────────────────┘
```

---

**文档版本**: v1.0.0  
**更新时间**: 2025-11-07  
**维护者**: 开发团队
